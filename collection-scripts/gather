#!/bin/bash -x

export BASE_COLLECTION_PATH="${BASE_COLLECTION_PATH:-/must-gather}"
export PROS=${PROS:-5}
DIR_NAME=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

# Collect resources information
"${DIR_NAME}"/gather_resources

"${DIR_NAME}"/vmConvertor

# Collect relevant namespaces data
"${DIR_NAME}"/gather_ns

# Collect HCO details (first, because it's there before anything else)
"${DIR_NAME}"/gather_hco

# Collect the CRDs
"${DIR_NAME}"/gather_crds

# Collect the CRs explicitly - some of them, like VMs, are collected by steps below
"${DIR_NAME}"/gather_crs

# Collect the apiservices
"${DIR_NAME}"/gather_apiservices

# Collect SSP details
"${DIR_NAME}"/gather_ssp

# Collect nodes details
"${DIR_NAME}"/gather_nodes

# Collect CDI details
"${DIR_NAME}"/gather_cdi

# Collect the webhooks
"${DIR_NAME}"/gather_webhooks

"${DIR_NAME}"/logs.sh

sync

exit 0
